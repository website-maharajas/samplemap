<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Path Finder</title>
    <style>
        /* --- CSS STYLING --- */
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background: #f0f2f5; }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 10px;
        }

        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        input, select, button {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        button {
            background-color: #28a745;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background-color: #218838; }

        /* MAP CONTAINER: Holds the Image and the Canvas Overlay */
        #map-wrapper {
            position: relative;
            display: inline-block;
            border: 2px solid #333;
        }

        /* Canvas must sit exactly on top of the image */
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none; /* Lets clicks pass through to image if needed */
        }
        
        img { display: block; max-width: 100%; height: auto; }
        
        .legend { font-size: 0.9em; margin-top: 10px; }
        .dot-green { color: green; font-weight: bold; }
        .dot-red { color: red; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>College Navigation System</h2>
    
    <div class="controls">
        <select id="startNode">
            <option value="main_gate">Main Gate</option>
            <option value="library">Library</option>
            <option value="ima_entrance">IMA Entrance</option>
        </select>

        <input type="text" id="destInput" placeholder="Enter Room (e.g. 101, 256)">

        <button onclick="findAndDrawPath()">Show Path</button>
    </div>

    <div id="map-wrapper">
        <img id="floorPlan" src="map.jpg" alt="College Map">
        <canvas id="overlayCanvas"></canvas>
    </div>

    <div class="legend">
        <span class="dot-green">● Ground Floor Path</span> | 
        <span class="dot-red">● First Floor Path</span>
    </div>
</div>

<script>
    // ==========================================
    // 1. THE DATA (GRAPH NODES & EDGES)
    // ==========================================
    
    // NODES: Represents Vertices (V) in Graph Theory
    // floor: 0 = Ground, 1 = First
    const nodes = {
        // --- GROUND FLOOR STARTING POINTS ---
        'main_gate':    { x: 50,  y: 450, floor: 0 },
        'library':      { x: 200, y: 100, floor: 0 },
        'ima_entrance': { x: 50,  y: 300, floor: 0 },

        // --- JUNCTIONS (Invisible nodes for walking paths) ---
        'junc_hall_A':  { x: 150, y: 300, floor: 0 }, // A hallway intersection
        'stair_bottom': { x: 400, y: 300, floor: 0 }, // Base of stairs

        // --- FIRST FLOOR NODES ---
        'stair_top':    { x: 400, y: 300, floor: 1 }, // Top of stairs (Same X,Y as bottom!)
        'junc_hall_B':  { x: 500, y: 300, floor: 1 }, 
        
        // --- DESTINATIONS ---
        '101':          { x: 250, y: 300, floor: 0 }, // Ground floor room
        '256':          { x: 600, y: 200, floor: 1 }, // First floor room
        'gnr hall':     { x: 700, y: 400, floor: 1 }  // First floor hall
    };

    // EDGES: Represents Connections in Graph Theory (Adjacency List)
    // Use bidirectional logic (if A->B, then B->A)
    const adjacency = {
        'main_gate':    ['junc_hall_A'],
        'ima_entrance': ['junc_hall_A'],
        'junc_hall_A':  ['main_gate', 'ima_entrance', '101', 'stair_bottom', 'library'],
        'library':      ['junc_hall_A'],
        '101':          ['junc_hall_A'],
        
        // The Magic Connection: Ground to First Floor
        'stair_bottom': ['junc_hall_A', 'stair_top'], 
        'stair_top':    ['stair_bottom', 'junc_hall_B'],
        
        'junc_hall_B':  ['stair_top', '256', 'gnr hall'],
        '256':          ['junc_hall_B'],
        'gnr hall':     ['junc_hall_B']
    };

    // ==========================================
    // 2. THE ALGORITHM (BFS PATHFINDING)
    // ==========================================

    function findAndDrawPath() {
        // Get Inputs
        const startId = document.getElementById('startNode').value;
        const destInput = document.getElementById('destInput').value.toLowerCase().trim();
        
        // 1. Validate Destination
        if (!nodes[destInput]) {
            alert("Destination not found! Try '101', '256', or 'gnr hall'");
            return;
        }

        // 2. Run BFS (Breadth-First Search)
        const path = bfs(startId, destInput);

        // 3. Draw Result
        if (path) {
            drawPathOnCanvas(path);
        } else {
            alert("No path found between these points.");
        }
    }

    // Standard BFS Algorithm to find shortest path in unweighted graph
    function bfs(start, end) {
        let queue = [[start]];
        let visited = new Set();
        visited.add(start);

        while (queue.length > 0) {
            let path = queue.shift();
            let node = path[path.length - 1];

            if (node === end) return path;

            if (adjacency[node]) {
                for (let neighbor of adjacency[node]) {
                    if (!visited.has(neighbor)) {
                        visited.add(neighbor);
                        let newPath = [...path, neighbor];
                        queue.push(newPath);
                    }
                }
            }
        }
        return null;
    }

    // ==========================================
    // 3. THE VISUALIZATION (CANVAS DRAWING)
    // ==========================================

    function drawPathOnCanvas(pathIds) {
        const img = document.getElementById('floorPlan');
        const canvas = document.getElementById('overlayCanvas');
        const ctx = canvas.getContext('2d');

        // Match canvas size to image size strictly
        canvas.width = img.naturalWidth; 
        canvas.height = img.naturalHeight;
        
        // Scale canvas visually to fit screen if needed
        canvas.style.width = img.width + "px";
        canvas.style.height = img.height + "px";

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Drawing Settings
        ctx.lineWidth = 6;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.setLineDash([15, 10]); // Dotted Effect (15px line, 10px gap)

        // Loop through path and draw segments
        for (let i = 0; i < pathIds.length - 1; i++) {
            let currNode = nodes[pathIds[i]];
            let nextNode = nodes[pathIds[i+1]];

            ctx.beginPath();
            ctx.moveTo(currNode.x, currNode.y);
            ctx.lineTo(nextNode.x, nextNode.y);

            // COLOR LOGIC:
            // If the destination of this segment is on Floor 1, use RED.
            // Otherwise (Floor 0), use GREEN.
            
            if (nextNode.floor === 1) {
                ctx.strokeStyle = "red";
                
                // Special case: If jumping from stair_bottom to stair_top
                // Draw nothing (or a circle) because distance is 0 pixels
                if (currNode.floor === 0) {
                   drawStairIcon(ctx, currNode.x, currNode.y);
                   ctx.strokeStyle = "transparent"; // Don't draw line for floor jump
                }
            } else {
                ctx.strokeStyle = "green";
            }

            ctx.stroke();
        }
        
        // Draw Start and End Circles
        drawPoint(ctx, nodes[pathIds[0]], "green");
        drawPoint(ctx, nodes[pathIds[pathIds.length-1]], "red");
    }
    
    function drawPoint(ctx, node, color) {
        ctx.beginPath();
        ctx.arc(node.x, node.y, 10, 0, 2 * Math.PI);
        ctx.fillStyle = color;
        ctx.fill();
        ctx.setLineDash([]); // Reset dash for circle border
        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;
        ctx.stroke();
    }

    function drawStairIcon(ctx, x, y) {
        ctx.beginPath();
        ctx.rect(x-15, y-15, 30, 30);
        ctx.fillStyle = "orange";
        ctx.fill();
        ctx.fillStyle = "white";
        ctx.font = "12px Arial";
        ctx.fillText("UP", x-8, y+4);
    }
</script>

</body>
</html>
